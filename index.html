<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>俳句ネプリ AKANTHA</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;700&family=Shippori+Mincho:wght@400;700&family=Cormorant+Garamond:ital,wght@0,300;0,600;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --green-deep: #1a2e1a;
    --green-mid: #2d5a27;
    --green-bright: #4a8c3f;
    --green-light: #7dba6e;
    --green-pale: #b8d9b0;
    --green-mist: #e8f2e5;
    --cream: #f7f3ec;
    --ink: #1a1a16;
    --gold: #b8973a;
    --gold-light: #d4b05a;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }
  body { background: var(--cream); color: var(--ink); font-family: 'Noto Serif JP', serif; overflow-x: hidden; }

  /* NAV */
  nav { position: fixed; top: 0; left: 0; right: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; padding: 1.2rem 3rem; background: rgba(26,46,26,0.92); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(184,151,58,0.3); }
  .nav-logo { font-family: 'Cormorant Garamond', serif; font-size: 1.3rem; font-weight: 600; letter-spacing: 0.2em; color: var(--gold-light); text-decoration: none; }
  .nav-links { display: flex; gap: 2.5rem; list-style: none; }
  .nav-links a { font-size: 0.78rem; font-weight: 300; letter-spacing: 0.15em; color: var(--green-pale); text-decoration: none; transition: color 0.3s; }
  .nav-links a:hover { color: var(--gold-light); }

  /* HERO */
  #hero { min-height: 100vh; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; background: var(--green-deep); }
  .hero-bg { position: absolute; inset: 0; background: radial-gradient(ellipse 70% 60% at 20% 50%, rgba(45,90,39,0.5) 0%, transparent 70%), radial-gradient(ellipse 50% 80% at 80% 30%, rgba(74,140,63,0.2) 0%, transparent 60%); }
  .hero-haiku-deco { position: absolute; right: 6rem; top: 50%; transform: translateY(-50%); writing-mode: vertical-rl; font-family: 'Shippori Mincho', serif; font-size: 1rem; color: rgba(184,217,176,0.25); letter-spacing: 0.3em; line-height: 3; pointer-events: none; }
  .hero-content { position: relative; z-index: 2; text-align: center; padding: 2rem; }
  .hero-en { font-family: 'Cormorant Garamond', serif; font-size: clamp(3.5rem,10vw,8rem); font-weight: 300; font-style: italic; letter-spacing: 0.08em; color: var(--green-pale); line-height: 1; animation: fadeUp 1s ease both; }
  .hero-en span { color: var(--gold); }
  .hero-jp { font-family: 'Shippori Mincho', serif; font-size: clamp(0.9rem,2vw,1.2rem); letter-spacing: 0.5em; color: var(--green-light); margin-top: 1rem; animation: fadeUp 1s 0.2s ease both; }
  .hero-divider { width: 60px; height: 1px; background: linear-gradient(to right, transparent, var(--gold), transparent); margin: 2rem auto; animation: fadeUp 1s 0.3s ease both; }
  .hero-tagline { font-size: clamp(0.75rem,1.5vw,0.9rem); font-weight: 300; letter-spacing: 0.3em; color: rgba(184,217,176,0.6); animation: fadeUp 1s 0.4s ease both; }
  .scroll-hint { position: absolute; bottom: 2.5rem; left: 50%; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; gap: 0.5rem; animation: fadeUp 1s 0.8s ease both; }
  .scroll-hint span { font-size: 0.7rem; letter-spacing: 0.3em; color: rgba(184,217,176,0.4); }
  .scroll-line { width: 1px; height: 40px; background: linear-gradient(to bottom, var(--gold), transparent); animation: scrollPulse 2s infinite; }
  @keyframes scrollPulse { 0%,100%{opacity:0.4} 50%{opacity:1} }
  @keyframes fadeUp { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

  /* SECTION */
  section { padding: 6rem 2rem; }
  .section-header { text-align: center; margin-bottom: 4rem; }
  .section-en { font-family: 'Cormorant Garamond', serif; font-size: clamp(2rem,5vw,3.5rem); font-weight: 300; font-style: italic; letter-spacing: 0.08em; color: var(--green-mid); }
  .section-jp { font-family: 'Shippori Mincho', serif; font-size: 0.8rem; letter-spacing: 0.4em; color: var(--green-bright); margin-top: 0.5rem; }
  .section-line { width: 40px; height: 1px; background: var(--gold); margin: 1.5rem auto 0; }

  /* ABOUT */
  #about { background: var(--green-deep); color: var(--cream); position: relative; overflow: hidden; }
  #about::before { content:''; position:absolute; top:-50%; left:-20%; width:80%; height:200%; background:radial-gradient(ellipse, rgba(74,140,63,0.15) 0%, transparent 70%); pointer-events:none; }
  #about .section-en { color: var(--green-pale); }
  #about .section-jp { color: var(--green-light); }
  .about-content { max-width: 700px; margin: 0 auto; position: relative; z-index: 2; }
  .about-text { font-size: clamp(0.9rem,1.8vw,1.05rem); font-weight: 300; line-height: 2.5; letter-spacing: 0.08em; color: var(--green-mist); text-align: justify; }
  .about-accent { display: block; font-family: 'Cormorant Garamond', serif; font-size: clamp(1.2rem,3vw,1.8rem); font-style: italic; font-weight: 300; color: var(--gold-light); letter-spacing: 0.1em; margin: 2.5rem 0; text-align: center; }

  /* CARDS (members & issues共通) */
  #members, #nepuri { background: var(--cream); }
  .members-grid, .issues-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px,1fr)); gap: 1.5rem; max-width: 900px; margin: 0 auto; }

  .member-card, .issue-card {
    background: #fff; border: 1px solid rgba(45,90,39,0.15); padding: 1.8rem 1.5rem;
    position: relative; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; cursor: pointer;
  }
  .member-card::before, .issue-card::before {
    content:''; position:absolute; top:0; left:0; width:3px; height:100%;
    background: linear-gradient(to bottom, var(--green-bright), var(--gold));
    transform: scaleY(0); transform-origin: top; transition: transform 0.4s ease;
  }
  .member-card:hover::before, .issue-card:hover::before { transform: scaleY(1); }
  .member-card:hover, .issue-card:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(26,46,26,0.12); }

  .member-number, .issue-vol { font-family: 'Cormorant Garamond', serif; font-size: 0.75rem; font-style: italic; color: var(--green-pale); letter-spacing: 0.2em; margin-bottom: 0.8rem; }
  .member-name, .issue-title { font-family: 'Shippori Mincho', serif; font-size: 1.05rem; font-weight: 700; color: var(--green-deep); letter-spacing: 0.1em; margin-bottom: 0.6rem; }
  .member-affil { font-size: 0.72rem; font-weight: 300; color: var(--green-bright); letter-spacing: 0.08em; margin-bottom: 0.5rem; }
  .member-twitter { display: inline-flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; font-weight: 300; color: var(--green-bright); text-decoration: none; letter-spacing: 0.05em; transition: color 0.3s; }
  .member-twitter:hover { color: var(--gold); }
  .member-twitter::before { content:'@'; font-family:'Cormorant Garamond',serif; font-style:italic; font-size:0.9rem; color:var(--gold-light); }
  .card-hint { position: absolute; bottom: 0.6rem; right: 0.8rem; font-size: 0.6rem; letter-spacing: 0.15em; color: var(--green-pale); font-weight: 300; }
  .issue-booth { font-size: 0.72rem; font-weight: 300; color: var(--green-bright); letter-spacing: 0.08em; }
  .issue-no-url { font-size: 0.72rem; font-weight: 300; color: var(--green-pale); letter-spacing: 0.08em; }

  /* MODAL */
  .modal-overlay { display: none; position: fixed; inset: 0; z-index: 200; background: rgba(10,20,10,0.75); backdrop-filter: blur(6px); align-items: center; justify-content: center; padding: 1.5rem; }
  .modal-overlay.open { display: flex; }
  .modal-box { background: var(--green-deep); border: 1px solid rgba(184,151,58,0.3); max-width: 520px; width: 100%; max-height: 88vh; overflow-y: auto; animation: modalIn 0.3s ease both; }
  @keyframes modalIn { from{opacity:0;transform:translateY(16px) scale(0.98)} to{opacity:1;transform:none} }
  .modal-header { padding: 2rem 2rem 1.2rem; border-bottom: 1px solid rgba(184,217,176,0.1); display: flex; justify-content: space-between; align-items: flex-start; }
  .modal-num { font-family: 'Cormorant Garamond', serif; font-size: 0.75rem; font-style: italic; color: var(--gold-light); letter-spacing: 0.2em; }
  .modal-nm { font-family: 'Shippori Mincho', serif; font-size: 1.4rem; font-weight: 700; color: var(--green-pale); letter-spacing: 0.12em; margin-top: 0.3rem; }
  .modal-af { font-size: 0.78rem; font-weight: 300; color: var(--green-light); letter-spacing: 0.1em; margin-top: 0.4rem; }
  .modal-close { background: none; border: 1px solid rgba(184,217,176,0.2); color: var(--green-pale); width: 2rem; height: 2rem; font-size: 1rem; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s; margin-left: 1rem; }
  .modal-close:hover { background: rgba(184,217,176,0.1); }
  .modal-body { padding: 1.8rem 2rem 2rem; }
  .modal-haiku-lbl { font-family: 'Cormorant Garamond', serif; font-size: 0.72rem; font-style: italic; letter-spacing: 0.3em; color: var(--gold-light); margin-bottom: 1.2rem; }
  .modal-haiku-list { list-style: none; display: flex; flex-direction: column; gap: 0.8rem; }
  .modal-haiku-list li { font-family: 'Shippori Mincho', serif; font-size: 1rem; color: var(--green-mist); letter-spacing: 0.18em; padding: 0.8rem 0; border-bottom: 1px solid rgba(184,217,176,0.08); line-height: 1.8; }
  .modal-tw { display: inline-flex; align-items: center; gap: 0.4rem; font-size: 0.75rem; font-weight: 300; color: var(--green-light); text-decoration: none; letter-spacing: 0.05em; margin-top: 1.5rem; transition: color 0.3s; }
  .modal-tw:hover { color: var(--gold-light); }
  .modal-tw::before { content:'@'; font-family:'Cormorant Garamond',serif; font-style:italic; font-size:0.9rem; color:var(--gold-light); }
  .modal-empty { font-size: 0.82rem; font-weight: 300; color: rgba(184,217,176,0.35); letter-spacing: 0.15em; font-style: italic; }

  /* PASSWORD MODAL */
  .pw-overlay { display: none; position: fixed; inset: 0; z-index: 300; background: rgba(10,20,10,0.85); backdrop-filter: blur(8px); align-items: center; justify-content: center; padding: 1.5rem; }
  .pw-overlay.open { display: flex; }
  .pw-box { background: var(--green-deep); border: 1px solid rgba(184,151,58,0.35); max-width: 360px; width: 100%; padding: 2.5rem 2rem; text-align: center; animation: modalIn 0.3s ease both; }
  .pw-title { font-family: 'Cormorant Garamond', serif; font-size: 1.1rem; font-style: italic; letter-spacing: 0.2em; color: var(--gold-light); margin-bottom: 0.5rem; }
  .pw-sub { font-size: 0.72rem; font-weight: 300; letter-spacing: 0.18em; color: var(--green-light); margin-bottom: 1.8rem; }
  .pw-input { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(184,217,176,0.2); color: var(--green-mist); font-family: 'Noto Serif JP', serif; font-size: 1rem; letter-spacing: 0.3em; padding: 0.75rem 1rem; text-align: center; outline: none; transition: border-color 0.2s; margin-bottom: 1rem; }
  .pw-input:focus { border-color: rgba(184,151,58,0.5); }
  .pw-err { font-size: 0.72rem; letter-spacing: 0.15em; color: #e06060; margin-bottom: 0.8rem; min-height: 1.2em; }
  .pw-btns { display: flex; gap: 0.8rem; justify-content: center; }
  .pw-ok { background: var(--green-mid); border: none; color: var(--cream); font-family: 'Noto Serif JP', serif; font-size: 0.78rem; letter-spacing: 0.25em; padding: 0.65rem 1.8rem; cursor: pointer; transition: background 0.3s; }
  .pw-ok:hover { background: var(--green-bright); }
  .pw-cancel { background: none; border: 1px solid rgba(184,217,176,0.2); color: var(--green-pale); font-family: 'Noto Serif JP', serif; font-size: 0.78rem; letter-spacing: 0.25em; padding: 0.65rem 1.8rem; cursor: pointer; transition: all 0.3s; }
  .pw-cancel:hover { border-color: var(--green-light); color: var(--green-light); }
  .pw-hint { font-size: 0.65rem; letter-spacing: 0.12em; color: rgba(184,217,176,0.25); margin-top: 1.5rem; }

  /* EDIT PANEL */
  .edit-toggle-btn { display: block; margin: 2.5rem auto 0; background: none; border: none; color: rgba(74,140,63,0.4); font-family: 'Noto Serif JP', serif; font-size: 0.65rem; letter-spacing: 0.2em; padding: 0.4rem 1rem; cursor: pointer; transition: all 0.3s; }
  .edit-toggle-btn:hover { color: var(--green-bright); }
  .edit-panel { display: none; max-width: 700px; margin: 2rem auto 0; background: var(--green-deep); border: 1px solid rgba(184,151,58,0.2); padding: 2rem; }
  .edit-panel.open { display: block; }
  .edit-panel-title { font-family: 'Cormorant Garamond', serif; font-size: 1rem; font-style: italic; letter-spacing: 0.2em; color: var(--gold-light); margin-bottom: 1.5rem; }
  .edit-select { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(184,217,176,0.2); color: var(--green-pale); font-family: 'Noto Serif JP', serif; font-size: 0.85rem; padding: 0.6rem 0.8rem; margin-bottom: 1.2rem; appearance: none; cursor: pointer; }
  .edit-label { display: block; font-size: 0.72rem; letter-spacing: 0.2em; color: var(--green-light); margin-bottom: 0.4rem; }
  .edit-input { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(184,217,176,0.15); color: var(--green-mist); font-family: 'Noto Serif JP', serif; font-size: 0.85rem; padding: 0.6rem 0.8rem; margin-bottom: 1rem; transition: border-color 0.2s; outline: none; }
  .edit-input:focus { border-color: rgba(184,151,58,0.5); }
  .haiku-row { display: flex; gap: 0.5rem; margin-bottom: 0.5rem; }
  .haiku-row .edit-input { flex: 1; margin-bottom: 0; }
  .edit-save-btn { background: var(--green-mid); border: none; color: var(--cream); font-family: 'Noto Serif JP', serif; font-size: 0.8rem; letter-spacing: 0.25em; padding: 0.7rem 2rem; cursor: pointer; transition: background 0.3s; margin-top: 0.5rem; }
  .edit-save-btn:hover { background: var(--green-bright); }
  .saved-msg { display: none; font-size: 0.72rem; letter-spacing: 0.2em; color: var(--gold-light); margin-top: 0.8rem; }

  /* LINKS */
  #links { background: var(--cream); }
  .links-content { max-width: 500px; margin: 0 auto; display: flex; flex-direction: column; gap: 1rem; align-items: center; }
  .link-item { display: flex; align-items: center; justify-content: space-between; width: 100%; padding: 1.2rem 1.8rem; background: #fff; border: 1px solid rgba(45,90,39,0.15); text-decoration: none; color: var(--green-deep); transition: all 0.3s; position: relative; overflow: hidden; }
  .link-item::before { content:''; position:absolute; inset:0; background:var(--green-deep); transform:translateX(-100%); transition:transform 0.4s ease; }
  .link-item:hover::before { transform: translateX(0); }
  .link-item:hover .link-label, .link-item:hover .link-arrow { color: var(--cream); }
  .link-item:hover .link-sub { color: var(--green-light); }
  .link-label { font-family: 'Shippori Mincho', serif; font-size: 0.95rem; letter-spacing: 0.15em; position: relative; z-index: 1; transition: color 0.3s; }
  .link-sub { font-size: 0.72rem; font-weight: 300; color: var(--green-bright); letter-spacing: 0.1em; position: relative; z-index: 1; transition: color 0.3s; }
  .link-info { display: flex; flex-direction: column; gap: 0.2rem; }
  .link-arrow { font-family: 'Cormorant Garamond', serif; font-size: 1.2rem; font-style: italic; color: var(--gold); position: relative; z-index: 1; transition: color 0.3s; }

  /* FOOTER */
  footer { background: var(--green-deep); border-top: 1px solid rgba(184,151,58,0.2); padding: 3rem 2rem; text-align: center; }
  .footer-logo { font-family: 'Cormorant Garamond', serif; font-size: 1.8rem; font-weight: 300; font-style: italic; letter-spacing: 0.15em; color: var(--gold-light); margin-bottom: 0.5rem; }
  .footer-jp { font-family: 'Shippori Mincho', serif; font-size: 0.75rem; letter-spacing: 0.4em; color: var(--green-light); margin-bottom: 2rem; }
  .footer-copy { font-size: 0.7rem; font-weight: 300; letter-spacing: 0.15em; color: rgba(184,217,176,0.3); }

  @media (max-width: 768px) {
    nav { padding: 1rem 1.5rem; } .nav-links { gap: 1.5rem; } .hero-haiku-deco { display: none; } section { padding: 4rem 1.2rem; }
  }
  @media (max-width: 480px) { .nav-links { gap: 1rem; } .nav-links a { font-size: 0.7rem; } }
</style>
</head>
<body>

<nav>
  <a href="#hero" class="nav-logo">AKANTHA</a>
  <ul class="nav-links">
    <li><a href="#about">について</a></li>
    <li><a href="#members">メンバー</a></li>
    <li><a href="#nepuri">ネプリ</a></li>
    <li><a href="#links">リンク</a></li>
  </ul>
</nav>

<section id="hero">
  <div class="hero-bg"></div>
  <div class="hero-haiku-deco">俳句の言葉が　静かに宿る　緑の中に</div>
  <div class="hero-content">
    <div class="hero-en">AK<span>A</span>NTHA</div>
    <div class="hero-jp">俳句ネプリ</div>
    <div class="hero-divider"></div>
    <div class="hero-tagline">言葉の束を　あなたの手へ</div>
  </div>
  <div class="scroll-hint"><span>scroll</span><div class="scroll-line"></div></div>
</section>

<section id="about">
  <div class="section-header">
    <div class="section-en">About</div>
    <div class="section-jp">AKANTHAについて</div>
    <div class="section-line"></div>
  </div>
  <div class="about-content">
    <span class="about-accent">— 棘を道標として —</span>
    <p class="about-text">
      「AKANTHA」はギリシャ語で「棘」を意味します。<br>
      いま、わたしたちにできることは何なのか。この棘を道標として揺るぎない「いま」を探していきたいと思います。
    </p>
  </div>
</section>

<!-- PASSWORD MODAL -->
<div class="pw-overlay" id="pwOverlay">
  <div class="pw-box">
    <div class="pw-title">Admin</div>
    <div class="pw-sub">管理者パスワードを入力してください</div>
    <input class="pw-input" id="pwInput" type="password" placeholder="••••••" autocomplete="off" maxlength="32">
    <div class="pw-err" id="pwErr"></div>
    <div class="pw-btns">
      <button class="pw-cancel" id="pwCancel">キャンセル</button>
      <button class="pw-ok" id="pwOk">解錠する</button>
    </div>
    <div class="pw-hint"></div>
  </div>
</div>

<!-- MEMBER MODAL -->
<div class="modal-overlay" id="memberModal">
  <div class="modal-box">
    <div class="modal-header">
      <div>
        <div class="modal-num" id="mNum"></div>
        <div class="modal-nm" id="mName"></div>
        <div class="modal-af" id="mAffil"></div>
      </div>
      <button class="modal-close" id="mClose">✕</button>
    </div>
    <div class="modal-body">
      <div class="modal-haiku-lbl">— 自選五句 —</div>
      <ul class="modal-haiku-list" id="mHaikuList"></ul>
      <a class="modal-tw" id="mTwitter" href="#" target="_blank"></a>
    </div>
  </div>
</div>

<!-- MEMBERS -->
<section id="members">
  <div class="section-header">
    <div class="section-en">Members</div>
    <div class="section-jp">メンバー</div>
    <div class="section-line"></div>
  </div>
  <div class="members-grid" id="membersGrid"></div>
  <button class="edit-toggle-btn" id="memberReloadBtn" onclick="loadMembers()">↺ 最新情報を読み込む</button>
</section>

<!-- NEPURI -->
<section id="nepuri">
  <div class="section-header">
    <div class="section-en">Net Print</div>
    <div class="section-jp">発行したネットプリント</div>
    <div class="section-line"></div>
  </div>
  <p style="text-align:center;max-width:600px;margin:0 auto 3rem;font-size:0.9rem;font-weight:300;line-height:2.2;color:var(--ink);letter-spacing:0.08em;">
    カードをタップするとBOOTHページへ移動します。
  </p>
  <div class="issues-grid" id="issuesGrid"></div>
  <button class="edit-toggle-btn" id="nepEditBtn" style="margin-top:2.5rem;">✎ ネプリを管理</button>
  <div class="edit-panel" id="nepEditPanel">
    <div class="edit-panel-title">Net Print Manager</div>
    <div id="nepIssueList" style="margin-bottom:1.5rem;"></div>
    <div style="border-top:1px solid rgba(184,217,176,0.1);padding-top:1.5rem;">
      <div class="edit-panel-title" style="font-size:0.85rem;margin-bottom:1rem;">＋ 新しい号を追加</div>
      <label class="edit-label">タイトル（例：創刊号、第○号）</label>
      <input class="edit-input" id="npTitle" type="text" placeholder="例：第六号">
      <label class="edit-label">BOOTHリンク</label>
      <input class="edit-input" id="npUrl" type="url" placeholder="https://booth.pm/...">
      <button class="edit-save-btn" id="npAddBtn">追加する</button>
      <div class="saved-msg" id="npSavedMsg">✓ 追加しました</div>
    </div>
  </div>
</section>

<!-- LINKS -->
<section id="links">
  <div class="section-header">
    <div class="section-en">Links</div>
    <div class="section-jp">リンク・お問い合わせ</div>
    <div class="section-line"></div>
  </div>
  <div class="links-content">
    <a href="https://twitter.com/akantha_575" target="_blank" class="link-item">
      <div class="link-info">
        <span class="link-label">公式Twitter</span>
        <span class="link-sub">@akantha_575</span>
      </div>
      <span class="link-arrow">→</span>
    </a>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSfGzHYjaXaJlZML8QqhbbXGQbxfSQmmHrmoYHBKXhPJR9zFsQ/viewform?usp=publish-editor" target="_blank" class="link-item">
      <div class="link-info">
        <span class="link-label">お問い合わせ</span>
        <span class="link-sub">Googleフォームへ</span>
      </div>
      <span class="link-arrow">→</span>
    </a>
  </div>
</section>

<footer>
  <div class="footer-logo">AKANTHA</div>
  <div class="footer-jp">俳句ネプリ</div>
  <div class="footer-copy">© 2025 俳句ネプリ AKANTHA. All rights reserved.</div>
</footer>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// ===== パスワード =====
const PW_KEY = 'akantha_pw';
const DEFAULT_PW = 'akantha2024';
const getPw = () => { try { return localStorage.getItem(PW_KEY) || DEFAULT_PW; } catch(e) { return DEFAULT_PW; } };
const setPw = v => { try { localStorage.setItem(PW_KEY, v); } catch(e) {} };

let pwTarget = null;
const pwOverlay = document.getElementById('pwOverlay');
const pwInput   = document.getElementById('pwInput');
const pwErr     = document.getElementById('pwErr');

const openPw = target => {
  pwTarget = target; pwInput.value = ''; pwErr.textContent = '';
  pwOverlay.classList.add('open'); setTimeout(() => pwInput.focus(), 80);
};
const closePw = () => pwOverlay.classList.remove('open');

document.getElementById('pwCancel').onclick = closePw;
pwOverlay.onclick = e => { if (e.target === pwOverlay) closePw(); };
document.addEventListener('keydown', e => { if (e.key === 'Escape') closePw(); });
pwInput.addEventListener('keydown', e => { if (e.key === 'Enter') tryUnlock(); });
document.getElementById('pwOk').onclick = tryUnlock;

function tryUnlock() {
  if (pwInput.value === getPw()) {
    closePw();
    openNepPanel();
  } else {
    pwErr.textContent = 'パスワードが違います';
    pwInput.value = ''; pwInput.focus();
    setTimeout(() => { pwErr.textContent = ''; }, 1800);
  }
}

// ===== メンバーデータ（Googleスプレッドシートから取得） =====
// Twitterは固定（スプレッドシートでは管理しない）
const MEMBER_TWITTER = {
  '伊藤映雪':   'slbzk',
  '沼野大統領':  'nogizaka_loony',
  '髙田祥聖':   '575inroute88',
  '嶋村らぴ':   'smmrrp',
  '細川鮪目':   'yumoku_haiku',
  'コンフィ':   'confitdragonite',
  'きつネつき':  'kitsunetsuki_VT',
  '四條たんし':  'toaruakademia',
};
const MEMBER_ORDER = ['伊藤映雪','沼野大統領','髙田祥聖','嶋村らぴ','細川鮪目','コンフィ','きつネつき','四條たんし'];

const SHEET_ID = '1ZuCCxPVZ1SJrv25EwbGQINSAlxc318Jp1gpqvXJ8zlE';
const CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/pub?output=csv`;

let members = [];

function parseCSV(text) {
  // 簡易CSVパーサー（ダブルクォート対応）
  const rows = [];
  const lines = text.trim().split('\n');
  for (const line of lines) {
    const cols = [];
    let cur = '', inQ = false;
    for (let i = 0; i < line.length; i++) {
      const ch = line[i];
      if (ch === '"') { inQ = !inQ; }
      else if (ch === ',' && !inQ) { cols.push(cur.trim()); cur = ''; }
      else { cur += ch; }
    }
    cols.push(cur.trim());
    rows.push(cols);
  }
  return rows;
}

async function loadMembers() {
  const grid = document.getElementById('membersGrid');
  grid.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:var(--green-pale);font-size:0.82rem;letter-spacing:0.2em;font-weight:300;">読み込み中…</p>`;
  try {
    const res = await fetch(CSV_URL);
    const text = await res.text();
    const rows = parseCSV(text);
    // 1行目がヘッダーなのでスキップ
    const dataRows = rows[0] && rows[0][0].toLowerCase().includes('name') ? rows.slice(1) : rows;
    // スプレッドシートの順番をMEMBER_ORDERに合わせる
    const map = {};
    for (const row of dataRows) {
      const name = row[0] ? row[0].trim() : '';
      if (!name) continue;
      map[name] = {
        name,
        affil: row[1] ? row[1].trim() : '',
        haiku: [row[2]||'', row[3]||'', row[4]||'', row[5]||'', row[6]||''].map(h => h.trim()),
      };
    }
    members = MEMBER_ORDER.map((name, idx) => ({
      id: idx,
      number: `No.${String(idx+1).padStart(2,'0')}`,
      name,
      twitter: MEMBER_TWITTER[name] || '',
      affil: map[name] ? map[name].affil : '',
      haiku: map[name] ? map[name].haiku : ['','','','',''],
    }));
  } catch(e) {
    // フェッチ失敗時はデフォルト表示
    members = MEMBER_ORDER.map((name, idx) => ({
      id: idx, number: `No.${String(idx+1).padStart(2,'0')}`,
      name, twitter: MEMBER_TWITTER[name] || '', affil: '', haiku: ['','','','',''],
    }));
  }
  renderMembers();
}

function renderMembers() {
  const g = document.getElementById('membersGrid'); g.innerHTML = '';
  members.forEach(m => {
    const c = document.createElement('div'); c.className = 'member-card';
    c.innerHTML = `
      <div class="member-number">${m.number}</div>
      <div class="member-name">${m.name}</div>
      ${m.affil ? `<div class="member-affil">${m.affil}</div>` : ''}
      ${m.twitter
        ? `<a href="https://twitter.com/${m.twitter}" target="_blank" class="member-twitter" onclick="event.stopPropagation()">${m.twitter}</a>`
        : `<span style="font-size:0.72rem;color:var(--green-pale);font-weight:300;">Twitter未登録</span>`}
      <span class="card-hint">tap →</span>`;
    c.onclick = () => openMemberModal(m.id);
    g.appendChild(c);
  });
}

// メンバーモーダル
const memberModal = document.getElementById('memberModal');
document.getElementById('mClose').onclick = () => closeMemberModal();
memberModal.onclick = e => { if (e.target === memberModal) closeMemberModal(); };
const openMemberModal = id => {
  const m = members.find(x => x.id === id); if (!m) return;
  document.getElementById('mNum').textContent = m.number;
  document.getElementById('mName').textContent = m.name;
  document.getElementById('mAffil').textContent = m.affil || '';
  const list = document.getElementById('mHaikuList');
  const f = m.haiku.filter(h => h.trim());
  list.innerHTML = f.length ? f.map(h => `<li>${h}</li>`).join('') : `<li class="modal-empty">（まだ句が登録されていません）</li>`;
  const tw = document.getElementById('mTwitter');
  if (m.twitter) { tw.href=`https://twitter.com/${m.twitter}`; tw.textContent=m.twitter; tw.style.display='inline-flex'; }
  else { tw.style.display='none'; }
  memberModal.classList.add('open'); document.body.style.overflow='hidden';
};
const closeMemberModal = () => { memberModal.classList.remove('open'); document.body.style.overflow=''; };

// ===== ネプリデータ =====
const NK = 'akantha_issues', NV = 'v3';
const DEFAULT_ISSUES = [
  { title:'創刊号', url:'https://booth.pm/ja/items/6816279' },
  { title:'第二号', url:'https://booth.pm/ja/items/7048796' },
  { title:'第三号', url:'https://booth.pm/ja/items/7301566' },
  { title:'第四号', url:'https://booth.pm/ja/items/7649296' },
  { title:'第五号', url:'https://booth.pm/ja/items/7980159' },
];
const loadIssues = () => {
  try { const s = localStorage.getItem(NK); if (s) { const p = JSON.parse(s); if (p && p._ver === NV && Array.isArray(p.data)) return p.data; } } catch(e) {}
  const d = DEFAULT_ISSUES.map(i => ({...i})); saveIssues(d); return d;
};
const saveIssues = data => { try { localStorage.setItem(NK, JSON.stringify({_ver:NV, data})); } catch(e) {} };
let issues = loadIssues();

function renderIssues() {
  const g = document.getElementById('issuesGrid'); g.innerHTML = '';
  if (!issues.length) { g.innerHTML = `<p style="text-align:center;color:var(--green-pale);font-size:0.82rem;grid-column:1/-1;">まだ登録されていません</p>`; return; }
  issues.forEach((iss, idx) => {
    const c = document.createElement('div'); c.className = 'issue-card';
    c.innerHTML = `
      <div class="issue-vol">Vol. ${String(idx+1).padStart(2,'0')}</div>
      <div class="issue-title">${iss.title}</div>
      ${iss.url ? `<span class="issue-booth">BOOTHで見る</span><span class="card-hint">tap →</span>` : `<span class="issue-no-url">URL未登録</span>`}`;
    if (iss.url) c.onclick = () => window.open(iss.url, '_blank', 'noopener');
    g.appendChild(c);
  });
}

function renderNepList() {
  const el = document.getElementById('nepIssueList'); if (!issues.length) { el.innerHTML=''; return; }
  el.innerHTML = issues.map((iss, idx) => `
    <div style="display:flex;justify-content:space-between;align-items:center;padding:0.8rem 0;border-bottom:1px solid rgba(184,217,176,0.08);gap:0.8rem;">
      <div>
        <span style="font-family:'Cormorant Garamond',serif;font-style:italic;font-size:0.75rem;color:var(--gold-light);">Vol.${String(idx+1).padStart(2,'0')}</span>
        <span style="font-family:'Shippori Mincho',serif;font-size:0.9rem;color:var(--green-pale);margin-left:0.7rem;">${iss.title}</span>
      </div>
      <div style="display:flex;gap:0.5rem;flex-shrink:0;">
        <button onclick="editIssue(${idx})" style="background:none;border:1px solid rgba(184,217,176,0.2);color:var(--green-light);font-size:0.68rem;padding:0.3rem 0.7rem;cursor:pointer;letter-spacing:0.1em;">編集</button>
        <button onclick="delIssue(${idx})" style="background:none;border:1px solid rgba(224,96,96,0.3);color:#e06060;font-size:0.68rem;padding:0.3rem 0.7rem;cursor:pointer;letter-spacing:0.1em;">削除</button>
      </div>
    </div>`).join('');
}

window.delIssue = idx => {
  if (!confirm(`「${issues[idx].title}」を削除しますか？`)) return;
  issues.splice(idx,1); saveIssues(issues); renderIssues(); renderNepList();
};
window.editIssue = idx => {
  document.getElementById('npTitle').value = issues[idx].title;
  document.getElementById('npUrl').value = issues[idx].url || '';
  const btn = document.getElementById('npAddBtn');
  btn.textContent = '更新する'; btn.dataset.ei = idx;
};

document.getElementById('npAddBtn').onclick = () => {
  const title = document.getElementById('npTitle').value.trim();
  if (!title) { alert('タイトルを入力してください'); return; }
  const entry = { title, url: document.getElementById('npUrl').value.trim() };
  const btn = document.getElementById('npAddBtn');
  const ei = btn.dataset.ei;
  if (ei !== undefined) { issues[parseInt(ei)] = entry; delete btn.dataset.ei; btn.textContent='追加する'; }
  else { issues.push(entry); }
  saveIssues(issues); renderIssues(); renderNepList();
  document.getElementById('npTitle').value=''; document.getElementById('npUrl').value='';
  const msg = document.getElementById('npSavedMsg');
  msg.textContent = ei !== undefined ? '✓ 更新しました' : '✓ 追加しました';
  msg.style.display='block'; setTimeout(()=>{ msg.style.display='none'; }, 2500);
};

document.getElementById('nepEditBtn').onclick = () => {
  if (document.getElementById('nepEditPanel').classList.contains('open')) closeNepPanel();
  else { pwInput.value=''; pwErr.textContent=''; pwOverlay.classList.add('open'); setTimeout(()=>pwInput.focus(),80); }
};
function openNepPanel() {
  document.getElementById('nepEditPanel').classList.add('open');
  document.getElementById('nepEditBtn').textContent = '✕ 管理を閉じる';
  renderNepList();
}
function closeNepPanel() {
  document.getElementById('nepEditPanel').classList.remove('open');
  document.getElementById('nepEditBtn').textContent = '✎ ネプリを管理';
}

// ===== 初期化 =====
loadMembers(); // スプレッドシートから非同期取得
renderIssues();
</script>
</body>
</html>
